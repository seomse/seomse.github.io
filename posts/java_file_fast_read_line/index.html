<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="java 파일 라인수 얻기, 특정라인 빨리 읽기 (빠른 라인처리)" /><meta name="author" content="macle" /><meta property="og:locale" content="en_US" /><meta name="description" content="작성자 : macle 작성자 블로그: https://macle.dev 원본경로: https://macle.dev/posts/java_file_fast_read_line/" /><meta property="og:description" content="작성자 : macle 작성자 블로그: https://macle.dev 원본경로: https://macle.dev/posts/java_file_fast_read_line/" /><link rel="canonical" href="https://seomse.github.io/posts/java_file_fast_read_line/" /><meta property="og:url" content="https://seomse.github.io/posts/java_file_fast_read_line/" /><meta property="og:site_name" content="Seomse" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-20T11:30:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="java 파일 라인수 얻기, 특정라인 빨리 읽기 (빠른 라인처리)" /><meta name="twitter:site" content="@comseomse" /><meta name="twitter:creator" content="@macle" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"작성자 : macle 작성자 블로그: https://macle.dev 원본경로: https://macle.dev/posts/java_file_fast_read_line/","url":"https://seomse.github.io/posts/java_file_fast_read_line/","@type":"BlogPosting","headline":"java 파일 라인수 얻기, 특정라인 빨리 읽기 (빠른 라인처리)","dateModified":"2021-03-27T21:57:56+09:00","datePublished":"2021-01-20T11:30:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://seomse.github.io/posts/java_file_fast_read_line/"},"author":{"@type":"Person","name":"macle"},"@context":"https://schema.org"}</script><title>java 파일 라인수 얻기, 특정라인 빨리 읽기 (빠른 라인처리) | Seomse</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/favicon.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://raw.githubusercontent.com/seomse/seomse.github.io/master/assets/img/s_avatar.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Seomse</a></div><div class="site-subtitle font-italic">개발자모임 섬세한사람들</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/seomse" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/comseomse" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['comseomse','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> posts </a> </span> <span>java 파일 라인수 얻기, 특정라인 빨리 읽기 (빠른 라인처리)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>java 파일 라인수 얻기, 특정라인 빨리 읽기 (빠른 라인처리)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 20, 2021, 11:30 AM +0900" > Jan 20 <i class="unloaded">2021-01-20T11:30:00+09:00</i> </span> by <span class="author"> macle </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Mar 27, 2021, 9:57 PM +0900" > Mar 27 <i class="unloaded">2021-03-27T21:57:56+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1127 words">6 min</span></div></div><div class="post-content"><ul><li>작성자 : macle<li>작성자 블로그: https://macle.dev<li>원본경로: https://macle.dev/posts/java_file_fast_read_line/</ul><h1 id="java-빠른-라인처리">java 빠른 라인처리</h1><p>개발을 하던중 데이터 시스템을 제작할 일이 생겨서 java 로 복잡하지 않은 시스템을 만들기로 하였습니다. 아래와같이 간단한 설계를 진행하였고 ..</p><ul><li>데이터는 json object 단위로 파일의 한라인에 입력<li>병렬 접근이 가능하게 하기위해 파일을 설정한 용량으로 나누어서 생성<li>각 데이터의 인덱스는 파일경로, 라인위치로 지정함</ul><p>위 요건들을 충족하기 위해서 빠른 속도로 파일 라인수를 읽고 특정라인을 빨리 읽어오는 부분이 필요하게 되었습니다.</p><h1 id="소스">소스</h1><p>예제 소스에서 사용되는 내용은 gradle로 의존성을 추가하고</p><div class="language-gradle highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">implementation</span> <span class="s1">'com.seomse.commons:seomse-commons:1.2.4'</span>
</pre></table></code></div></div><p>java 소스에서 아래와 같이 사용할 수 있습니다</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="nc">FileUtil</span><span class="o">.</span><span class="na">getLineCount</span><span class="o">(</span><span class="n">filePath</span><span class="o">);</span>
<span class="nc">String</span> <span class="n">lineValue</span> <span class="o">=</span> <span class="nc">FileUtil</span><span class="o">.</span><span class="na">getLine</span><span class="o">(</span><span class="n">filePath</span><span class="o">,</span> <span class="mi">77</span><span class="o">)</span>
</pre></table></code></div></div><h1 id="성능비교">성능비교</h1><h2 id="성능-비교에-사용한-소스">성능 비교에 사용한 소스</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>
<span class="c1">//java.io 패키지 사용</span>
<span class="k">try</span><span class="o">(</span><span class="nc">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">),</span> <span class="n">charSet</span><span class="o">))){</span>
	 <span class="nc">String</span> <span class="n">line</span><span class="o">;</span>
     <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

     <span class="o">}</span>
<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">){</span>
	<span class="k">throw</span> <span class="k">new</span> <span class="nf">IORuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="o">}</span>


<span class="c1">//java.nio 패키지 사용</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="nc">Files</span><span class="o">.</span><span class="na">lines</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">path</span><span class="o">),</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">))</span> <span class="o">{</span>
    <span class="c1">//noinspection OptionalGetWithoutIsPresent</span>
    <span class="k">return</span> <span class="n">lines</span><span class="o">.</span><span class="na">skip</span><span class="o">(</span><span class="n">lineIndex</span><span class="o">).</span><span class="na">findFirst</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">){</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">IORuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="o">}</span>

</pre></table></code></div></div><p>위와 같은 방식으로 구현하여 각각 성능측정을 해보니 nio 가 약간더 좋은 성능을 보였습니다.</p><p>이번에는 byte[] 로 읽어와서 \n 의 건수를 측정하거나. 이부분만 String 으로 변환하는 방법을 사용하였더니 훨씬더 빠른 성능을 보였습니다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre>
<span class="k">try</span> <span class="o">(</span>
		<span class="nc">FileInputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">path</span><span class="o">)</span>
<span class="o">){</span>

	<span class="kt">int</span> <span class="n">lastLineIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

	<span class="kt">boolean</span> <span class="n">isMake</span> <span class="o">=</span> <span class="n">lineIndex</span> <span class="o">==</span> <span class="n">lastLineIndex</span><span class="o">;</span>

	<span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">byteList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
	<span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

	<span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">10240</span><span class="o">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="o">;</span>

	<span class="k">while</span> <span class="o">((</span><span class="n">n</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>

		<span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>

			<span class="k">if</span> <span class="o">(</span><span class="n">buffer</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">lastLineIndex</span><span class="o">++;</span>
				<span class="k">if</span><span class="o">(</span><span class="n">isMake</span><span class="o">){</span>

					<span class="kt">byte</span> <span class="o">[]</span> <span class="n">add</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOfRange</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="n">start</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
					<span class="n">size</span> <span class="o">+=</span> <span class="n">add</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
					<span class="n">byteList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">add</span><span class="o">);</span>

					<span class="k">return</span> <span class="nf">toStringBytesList</span><span class="o">(</span><span class="n">byteList</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="n">isMake</span> <span class="o">=</span> <span class="n">lineIndex</span> <span class="o">==</span> <span class="n">lastLineIndex</span><span class="o">;</span>
				<span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="k">if</span><span class="o">(</span><span class="n">isMake</span><span class="o">){</span>
			<span class="kt">byte</span> <span class="o">[]</span> <span class="n">add</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOfRange</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="n">start</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>
			<span class="n">size</span> <span class="o">+=</span> <span class="n">add</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
			<span class="n">byteList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">add</span><span class="o">);</span>

		<span class="o">}</span>
	<span class="o">}</span>


	<span class="k">if</span><span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
		<span class="k">return</span> <span class="s">""</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="k">return</span> <span class="nf">toStringBytesList</span><span class="o">(</span><span class="n">byteList</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">){</span>
	<span class="k">throw</span> <span class="k">new</span> <span class="nf">IORuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="o">}</span>

</pre></table></code></div></div><h2 id="성능비교-소스">성능비교 소스</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">com.seomse.commons.utils.FileUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.seomse.commons.utils.time.TimeUtil</span><span class="o">;</span>

<span class="cm">/**
 * 인메모리 검색 분석 엔진에서
 * 파엘에 저장된 상세 정보를 가져올때 사용하려고 core 기술 개발중 빠른 line 텍스트 성능 테스트
 * @author macle
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileReadLineNumberSpeedTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>


        <span class="nc">String</span> <span class="n">testFilePath</span> <span class="o">=</span> <span class="s">"D:\\seomse\\index\\20200201\\index_0.md"</span><span class="o">;</span>
        <span class="c1">//200 라인의 파일을 사용</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span><span class="mi">200</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="c1">//일치여부 테스트</span>
			<span class="k">if</span><span class="o">(!</span><span class="nc">FileUtil</span><span class="o">.</span><span class="na">getLineNio</span><span class="o">(</span><span class="n">testFilePath</span><span class="o">,</span> <span class="n">i</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="nc">FileUtil</span><span class="o">.</span><span class="na">getLine</span><span class="o">(</span><span class="n">testFilePath</span><span class="o">,</span> <span class="n">i</span><span class="o">))){</span>
				<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>

        <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span><span class="mi">500</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">FileUtil</span><span class="o">.</span><span class="na">getLineNio</span><span class="o">(</span><span class="n">testFilePath</span><span class="o">,</span> <span class="mi">50</span><span class="o">);</span>
		<span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"line value Nio 속도: "</span> <span class="o">+</span> <span class="nc">TimeUtil</span><span class="o">.</span><span class="na">getSecond</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()-</span><span class="n">startTime</span><span class="o">));</span>
        <span class="n">startTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span><span class="mi">500</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">FileUtil</span><span class="o">.</span><span class="na">getLine</span><span class="o">(</span><span class="n">testFilePath</span><span class="o">,</span> <span class="mi">50</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"line value core 기술 구현체 속도: "</span> <span class="o">+</span> <span class="nc">TimeUtil</span><span class="o">.</span><span class="na">getSecond</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()-</span><span class="n">startTime</span><span class="o">));</span>

        <span class="n">startTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span><span class="mi">500</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">FileUtil</span><span class="o">.</span><span class="na">getLineCountNio</span><span class="o">(</span><span class="n">testFilePath</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"line count  Nio 속도: "</span> <span class="o">+</span> <span class="nc">TimeUtil</span><span class="o">.</span><span class="na">getSecond</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()-</span><span class="n">startTime</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nc">FileUtil</span><span class="o">.</span><span class="na">getLineCountNio</span><span class="o">(</span><span class="n">testFilePath</span><span class="o">));</span>

        <span class="n">startTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span><span class="mi">500</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">FileUtil</span><span class="o">.</span><span class="na">getLineCount</span><span class="o">(</span><span class="n">testFilePath</span><span class="o">);</span>
		<span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"line count core 기술 구현체 속도: "</span> <span class="o">+</span> <span class="nc">TimeUtil</span><span class="o">.</span><span class="na">getSecond</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()-</span><span class="n">startTime</span><span class="o">)</span> <span class="o">+</span><span class="s">" "</span> <span class="o">+</span> <span class="nc">FileUtil</span><span class="o">.</span><span class="na">getLineCount</span><span class="o">(</span><span class="n">testFilePath</span><span class="o">));</span>

    <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><h1 id="결과">결과</h1><p>위소스와 같이 500번의 반복을 해서 실험했을떄 나온 결과는</p><ul><li>line value Nio 속도: 2.557<li>line value core 기술 구현체 속도: 0.483<li>line count Nio 속도: 11.008 200<li>line count core 기술 구현체 속도: 1.56 200</ul><p>특정라인을 읽을때는 5.3 배정도 라인수를 측정할때 걸리는 속도는 7배 정도의 성능차이를 보였습니다. 정확한 원인에 대한 이유는 알지 못했지만 추측해보자면 nio의 Stream을 활용할 때는 모든 라인을 문자열로 변환하는 시간이 들어가는 것으로 예상됩니다.</p><p>라인문자만 체크해보고 필요한 부분만 문자열로 변환하기 때문이 아닐까 추측 하고 있습니다.</p><p>파일 크기가 크면 클수록 성능 차이는 심할 것으로 예상됩니다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EA%B0%9C%EB%B0%9C/'>개발</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/file/" class="post-tag no-text-decoration" >file</a> <a href="/tags/macle/" class="post-tag no-text-decoration" >macle</a> <a href="/tags/data/" class="post-tag no-text-decoration" >data</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=java 파일 라인수 얻기, 특정라인 빨리 읽기 (빠른 라인처리) - Seomse&url=https://seomse.github.io/posts/java_file_fast_read_line/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=java 파일 라인수 얻기, 특정라인 빨리 읽기 (빠른 라인처리) - Seomse&u=https://seomse.github.io/posts/java_file_fast_read_line/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=java 파일 라인수 얻기, 특정라인 빨리 읽기 (빠른 라인처리) - Seomse&url=https://seomse.github.io/posts/java_file_fast_read_line/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/realtime-search-analysis/">리얼타임 인메모리 검색, 분석, 통계</a><li><a href="/posts/trading-auto-dev-ing/">자동매매를 개발하면서 경험한 것(주식, ETF, 선물, 비트코인)</a><li><a href="/posts/parallel-processing/">빅데이터 파일 병렬처리 플랫폼을 개발하면서</a><li><a href="/posts/elk-stack/">ELK Stack 설치하기</a><li><a href="/posts/seomse-jdbc/">seomse-jdbc 개발 배경과 활용법</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/macle/">macle</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/etf/">ETF</a> <a class="post-tag" href="/tags/%EC%84%A0%EB%AC%BC/">선물</a> <a class="post-tag" href="/tags/%EC%A3%BC%EC%8B%9D/">주식</a> <a class="post-tag" href="/tags/file/">file</a> <a class="post-tag" href="/tags/wjrmffldrhrl/">wjrmffldrhrl</a> <a class="post-tag" href="/tags/%EB%B3%91%EB%A0%AC%EC%B2%98%EB%A6%AC/">병렬처리</a> <a class="post-tag" href="/tags/%EB%B9%84%ED%8A%B8%EC%BD%94%EC%9D%B8/">비트코인</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/parallel-processing/"><div class="card-body"> <span class="timeago small" > Mar 27 <i class="unloaded">2021-03-27T22:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>빅데이터 파일 병렬처리 플랫폼을 개발하면서</h3><div class="text-muted small"><p> 작성자 : macle 작성자 블로그: https://macle.dev 원본경로: https://macle.dev/posts/parallel-processing/ 개요 최근에는 병렬처리쪽은 대부분 GPU 로 진행합니다. 적당한 그래픽카드도 쿠다프로세스가 수천개씩 있기 떄문입니다. CPU 는 지금 시점에서 괜찮은것을 구매해도 12코어 24...</p></div></div></a></div><div class="card"> <a href="/posts/seomse-jdbc/"><div class="card-body"> <span class="timeago small" > Mar 25 <i class="unloaded">2021-03-25T22:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>seomse-jdbc 개발 배경과 활용법</h3><div class="text-muted small"><p> 작성자 : macle 작성자 블로그: https://macle.dev 원본경로: https://macle.dev/posts/seomse-jdbc/ 개요 java 진영의 jdbc 는 jpa, Hibernate, mybatis 등 다양하게 쓸 수 있는 방법 많습니다. 관련 라이브러리를 개발한 시기는 대략 2013년 쯤으로 기억하는...</p></div></div></a></div><div class="card"> <a href="/posts/realtime-search-analysis/"><div class="card-body"> <span class="timeago small" > Apr 3 <i class="unloaded">2021-04-03T22:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>리얼타임 인메모리 검색, 분석, 통계</h3><div class="text-muted small"><p> 아직 작성중인 글로 완성 된 내용이 아닙니다. 내용이 많아서 시간의 여유가 되는 대로 추가로 작성될 예정 입니다. 작성자 : macle 작성자 블로그: https://macle.dev 원본경로: https://macle.dev/posts/realtime-search-analysis/ 개요 테그클라우드, 의미네트워크, ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/trading_etf_backtest/" class="btn btn-outline-primary"><p>자동매매 ETF 백테스팅 (레버리지, 인버스)</p></a> <a href="/posts/Java-Serialization/" class="btn btn-outline-primary"><p>Java Serialization</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//https-seomse-github-io-1.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://seomse.github.io/posts/java_file_fast_read_line/'; this.page.identifier = '/posts/java_file_fast_read_line/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/comseomse">seomse</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/macle/">macle</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/etf/">ETF</a> <a class="post-tag" href="/tags/%EC%84%A0%EB%AC%BC/">선물</a> <a class="post-tag" href="/tags/%EC%A3%BC%EC%8B%9D/">주식</a> <a class="post-tag" href="/tags/file/">file</a> <a class="post-tag" href="/tags/wjrmffldrhrl/">wjrmffldrhrl</a> <a class="post-tag" href="/tags/%EB%B3%91%EB%A0%AC%EC%B2%98%EB%A6%AC/">병렬처리</a> <a class="post-tag" href="/tags/%EB%B9%84%ED%8A%B8%EC%BD%94%EC%9D%B8/">비트코인</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://seomse.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
