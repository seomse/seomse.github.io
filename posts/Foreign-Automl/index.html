<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="선물시장 외국인 수급과 AutoML 연구" /><meta name="author" content="wjrmffldrhrl" /><meta property="og:locale" content="en_US" /><meta name="description" content="작성자 : wjrmffldrhrl 작성자 블로그: https://wjrmffldrhrl.github.io/ 원본경로: https://wjrmffldrhrl.github.io/stock-analysis/" /><meta property="og:description" content="작성자 : wjrmffldrhrl 작성자 블로그: https://wjrmffldrhrl.github.io/ 원본경로: https://wjrmffldrhrl.github.io/stock-analysis/" /><link rel="canonical" href="https://seomse.github.io/posts/Foreign-Automl/" /><meta property="og:url" content="https://seomse.github.io/posts/Foreign-Automl/" /><meta property="og:site_name" content="Seomse" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-25T22:30:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="선물시장 외국인 수급과 AutoML 연구" /><meta name="twitter:site" content="@comseomse" /><meta name="twitter:creator" content="@wjrmffldrhrl" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"작성자 : wjrmffldrhrl 작성자 블로그: https://wjrmffldrhrl.github.io/ 원본경로: https://wjrmffldrhrl.github.io/stock-analysis/","url":"https://seomse.github.io/posts/Foreign-Automl/","@type":"BlogPosting","headline":"선물시장 외국인 수급과 AutoML 연구","dateModified":"2021-03-27T21:57:56+09:00","datePublished":"2021-03-25T22:30:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://seomse.github.io/posts/Foreign-Automl/"},"author":{"@type":"Person","name":"wjrmffldrhrl"},"@context":"https://schema.org"}</script><title>선물시장 외국인 수급과 AutoML 연구 | Seomse</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/favicon.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://raw.githubusercontent.com/seomse/seomse.github.io/master/assets/img/s_avatar.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Seomse</a></div><div class="site-subtitle font-italic">개발자모임 섬세한사람들</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/seomse" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/comseomse" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['comseomse','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> posts </a> </span> <span>선물시장 외국인 수급과 AutoML 연구</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>선물시장 외국인 수급과 AutoML 연구</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Mar 25, 2021, 10:30 PM +0900" > Mar 25 <i class="unloaded">2021-03-25T22:30:00+09:00</i> </span> by <span class="author"> wjrmffldrhrl </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Mar 27, 2021, 9:57 PM +0900" > Mar 27 <i class="unloaded">2021-03-27T21:57:56+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3003 words">16 min</span></div></div><div class="post-content"><ul><li>작성자 : wjrmffldrhrl<li>작성자 블로그: https://wjrmffldrhrl.github.io/<li>원본경로: https://wjrmffldrhrl.github.io/stock-analysis/</ul><h1 id="auto-trading">Auto Trading</h1><h1 id="결과">결과</h1><p>내용을 작성하기에 앞서 결과적으로는 좋은 성능의 예측 모델을 만들지 못했다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://wjrmffldrhrl.github.io/assets/images/stock_analysis/chart1.png" alt="chart1" /></p><p>AutoML을 사용해 다양한 Feature(장 초반 생성되는 패턴)를 학습시켜 장 마감 지수를 예측하려고 했지만, 거의 예측을 하지 못하는 모델이 학습됐다.</p><h1 id="접근">접근</h1><p>보통 시계열이나 회귀 문제로 접근하는 주식 시장의 흐름을 패턴에 맞춰 대응한다는 개념으로 분류 문제로 접근해보기로 했다.</p><p>현재 분석 가능한 데이터는 다음과 같다.</p><ul><li>거래소_선물지수 1분봉<li>외국인거래소_매도금액 1분봉<li>외국인거래소_매수금액 1분봉<li>외국인거래소_선물매도량 1분봉<li>외국인거래소_선물매수량 1분봉</ul><p>위 목록의 데이터들은 2017년 1월부터 2021년 3월 초의 장 시작부터 장 마감까지 시가, 고가, 저가, 종가로 이루어져있다.</p><h3 id="거래소_선물지수_1분봉csv">거래소_선물지수_1분봉.csv</h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>
            Date   Time    Open    High     Low   Close   Up  Down
0       20170102  10:01  260.05  260.30  260.00  260.10  409  1312
1       20170102  10:02  260.10  260.20  259.90  259.95  341   679
2       20170102  10:03  259.95  260.05  259.90  259.95  419   455
3       20170102  10:04  259.95  260.00  259.90  259.95  153   294
4       20170102  10:05  259.90  259.95  259.85  259.90  155   515
...          ...    ...     ...     ...     ...     ...  ...   ...
374322  20210305  15:32  411.90  412.20  411.90  412.10  455   194
374323  20210305  15:33  412.10  412.20  412.05  412.15  224   121
374324  20210305  15:34  412.15  412.25  412.05  412.05  214   266
374325  20210305  15:35  412.00  412.05  411.80  411.90  293   461
374326  20210305  15:46  411.75  411.75  411.75  411.75    0  4455
[374327 rows x 8 columns]
</pre></table></code></div></div><h3 id="외국인거래소_매수금액_1분봉">외국인거래소_매수금액_1분봉</h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>             Date   Time      Open      High       Low     Close  Up  Down
0       20170102  08:31      0.00      0.00      0.00      0.00   0     0
1       20170102  08:32      0.00      0.00      0.00      0.00   0     0
2       20170102  08:34      0.00      0.00      0.00      0.00   0     0
3       20170102  08:35      0.07      0.07      0.07      0.07   0     0
4       20170102  08:37      0.07      0.07      0.07      0.07   0     0
...          ...    ...       ...       ...       ...       ...  ..   ...
414042  20210305  17:59  31984.56  31984.56  31984.56  31984.56   0     0
414043  20210305  18:01  31984.56  31984.56  31984.56  31984.56   0     0
414044  20210305  18:02  31984.69  31984.69  31984.69  31984.69   0     0
414045  20210305  18:04  31984.69  31984.69  31984.69  31984.69   0     0
414046  20210305  18:05  33121.43  33121.43  33121.43  33121.43   0     0

[414047 rows x 8 columns]
</pre></table></code></div></div><p>각 컬럼 <code class="language-plaintext highlighter-rouge">"Date","Time","Open","High","Low","Close","Up","Down"</code>는 날짜,시간,시가,고가,저가,종가,상승체결,하락체결을 의미한다.</p><p>모든 데이터들은 1분봉으로 이루어져 있기 때문에 시가, 고가 등등 1분동안 크게 변화가 없으므로 시가 정보인 Open 데이터만 분석에 사용한다.</p><p>거래소 선물지수 데이터는 그대로 사용하고 외국인 거래량, 거래액은 거래량을 사용하되 순 거래량을 계산해서 사용하기로 한다.</p><h3 id="선물지수-순거래량-차트">선물지수, 순거래량 차트</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://wjrmffldrhrl.github.io/assets/images/stock_analysis/chart1.png" alt="chart1" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://wjrmffldrhrl.github.io/assets/images/stock_analysis/chart2.png" alt="chart2" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://wjrmffldrhrl.github.io/assets/images/stock_analysis/chart3.png" alt="chart3" /></p><p><code class="language-plaintext highlighter-rouge">Net_Purchase</code>는 외국인 순 거래량, <code class="language-plaintext highlighter-rouge">Index</code>는 선물지수이다.</p><h1 id="데이터-처리">데이터 처리</h1><p>전체 데이터 중 일부 데이터를 사용해 두 지수를 비교하였고 값의 단위가 다르기 때문에 <code class="language-plaintext highlighter-rouge">sklearn.preprocessing</code>의 <code class="language-plaintext highlighter-rouge">MinMaxScaler</code>를 사용해 정규화를 진행했다.</p><p>두 데이터에서 학습 데이터를 추출해야 하는데 위에서 말했던 것 처럼 분류의 형태로 접근할 것이다.</p><p>장 초반에 생성되는 지수 패턴과 순매수량 패턴을 feature로 잡고 장 마감시 지수가 패턴이 끝날 때 지수보다 1%이상 상승했으면 Positive, 아니라면 Negative로 보고 이항 분류 형태의 데이터를 만들 것이다.</p><h3 id="get_train_data">get_train_data</h3><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">get_train_data</span><span class="p">(</span><span class="n">pattern_data</span><span class="p">,</span> <span class="n">index_data</span><span class="p">,</span>
                   <span class="n">target_pattern_column</span><span class="o">=</span><span class="s">'Net_Purchase'</span><span class="p">,</span> <span class="n">target_index_column</span><span class="o">=</span><span class="s">'Open'</span><span class="p">,</span>
                   <span class="n">use_index_data_to_pattern</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">need_increase_percentage</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                   <span class="n">pattern_start_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pattern_end_position</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>


    <span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pattern_data</span><span class="p">[</span><span class="s">'Date'</span><span class="p">].</span><span class="n">values</span><span class="p">)</span>
    <span class="n">feature_labels</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">target_pattern_data</span> <span class="o">=</span> <span class="n">pattern_data</span><span class="p">[</span><span class="n">pattern_data</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span> <span class="o">==</span> <span class="n">date</span><span class="p">].</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span>
            <span class="n">target_index_data</span> <span class="o">=</span> <span class="n">index_data</span><span class="p">[</span><span class="n">pattern_data</span><span class="p">[</span><span class="s">'Date'</span><span class="p">]</span> <span class="o">==</span> <span class="n">date</span><span class="p">].</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span>

            <span class="n">target_pattern_column_position</span> <span class="o">=</span> <span class="n">target_pattern_data</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">target_pattern_column</span><span class="p">)</span>
            <span class="n">target_index_column_position</span> <span class="o">=</span> <span class="n">target_index_data</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">target_index_column</span><span class="p">)</span>

            <span class="n">start_index_position</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">use_index_data_to_pattern</span><span class="p">:</span>
                <span class="n">start_index_position</span> <span class="o">=</span> <span class="n">pattern_end_position</span>

            <span class="n">start_index</span> <span class="o">=</span> <span class="n">target_index_data</span><span class="p">[</span><span class="n">target_index_column</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">start_index_position</span><span class="p">]</span>
            <span class="n">end_index</span> <span class="o">=</span> <span class="n">target_index_data</span><span class="p">[</span><span class="n">target_index_column</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">label</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">end_index</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">*</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">need_increase_percentage</span><span class="p">)):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
            <span class="n">scaler</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">target_pattern_data</span><span class="p">)</span>
            <span class="n">scaled_target_pattern</span> <span class="o">=</span> <span class="n">scaler</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">target_pattern_data</span><span class="p">)</span>

            <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
            <span class="n">scaler</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">target_index_data</span><span class="p">)</span>
            <span class="n">scaled_target_index</span> <span class="o">=</span> <span class="n">scaler</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">target_index_data</span><span class="p">)</span>

            <span class="n">feature_label</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">scaled_target_pattern</span><span class="p">[:,</span> <span class="n">target_pattern_column_position</span><span class="p">][</span><span class="n">pattern_start_position</span><span class="p">:</span><span class="n">pattern_end_position</span><span class="p">]:</span>
                <span class="n">feature_label</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">use_index_data_to_pattern</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">scaled_target_index</span><span class="p">[:,</span> <span class="n">target_index_column_position</span><span class="p">][</span><span class="n">pattern_start_position</span><span class="p">:</span><span class="n">pattern_end_position</span><span class="p">]:</span>
                    <span class="n">feature_label</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

            <span class="n">feature_label</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">feature_labels</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_label</span><span class="p">)</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'error in '</span> <span class="o">+</span> <span class="n">date</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">feature_labels</span>
</pre></table></code></div></div><p>하루에 생성되는 데이터를 결합하여 한 row로 생성할 것이고 <code class="language-plaintext highlighter-rouge">pattern_end_position</code>부터 <code class="language-plaintext highlighter-rouge">pattern_end_position</code> 까지 생성되는 데이터를 패턴으로 판단하여 feature로 row에 추가한다.</p><p>기본값이 0 ~ 30으로 잡혀있는데 이는 장 시작 9:00 부터 장 마감 16:20 까지 420여개(종종 몇개의 분봉은 넘어가는 데이터도 존재함)의 분봉이 존재하므로 position값 1당 1분으로 봐도 무방하다.</p><p>즉 장 시작 30분간의 패턴을 학습에 사용되는 Feature로 사용한다는 뜻이다.</p><p>그 다음 장 마감시 지수가 장 초반 (패턴을 읽은 뒤 : 장 시작 30분 후) 지수보다 1%이상 상승했다면 Positive(1)로 아니라면 Negative(0)로 잡고 Label을 생성한다.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">start_index</span> <span class="o">=</span> <span class="n">target_index_data</span><span class="p">[</span><span class="n">target_index_column</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">start_index_position</span><span class="p">]</span>
<span class="n">end_index</span> <span class="o">=</span> <span class="n">target_index_data</span><span class="p">[</span><span class="n">target_index_column</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">label</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">if</span> <span class="n">end_index</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">*</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">need_increase_percentage</span><span class="p">)):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="mi">1</span>
</pre></table></code></div></div><p>마지막으로 모든 데이터를 <code class="language-plaintext highlighter-rouge">MinMaxScaler</code>로 정규화 하고 학습용 데이터를 생성한다.</p><p>생성된 학습 데이터는 아래와 같은 형태다.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">2</span>	<span class="mi">3</span>	<span class="mi">4</span>	<span class="mi">5</span>	<span class="mi">6</span>	<span class="mi">7</span>	<span class="mi">8</span>	<span class="mi">9</span>	<span class="mi">10</span>	<span class="mi">11</span>	<span class="mi">12</span>	<span class="mi">13</span>	<span class="mi">14</span>	<span class="mi">15</span>	<span class="mi">16</span>	<span class="mi">17</span>	<span class="mi">18</span>	<span class="mi">19</span>	<span class="mi">20</span>	<span class="mi">21</span>	<span class="mi">22</span>	<span class="mi">23</span>	<span class="mi">24</span>	<span class="mi">25</span>	<span class="mi">26</span>	<span class="mi">27</span>	<span class="mi">28</span>	<span class="mi">29</span>	<span class="mi">30</span>	<span class="mi">31</span>	<span class="mi">32</span>	<span class="mi">33</span>	<span class="mi">34</span>	<span class="mi">35</span>	<span class="mi">36</span>	<span class="mi">37</span>	<span class="mi">38</span>	<span class="mi">39</span>	<span class="mi">40</span>	<span class="mi">41</span>	<span class="mi">42</span>	<span class="mi">43</span>	<span class="mi">44</span>	<span class="mi">45</span>	<span class="mi">46</span>	<span class="mi">47</span>	<span class="mi">48</span>	<span class="mi">49</span>	<span class="mi">50</span>	<span class="mi">51</span>	<span class="mi">52</span>	<span class="mi">53</span>	<span class="mi">54</span>	<span class="mi">55</span>	<span class="mi">56</span>	<span class="mi">57</span>	<span class="mi">58</span>	<span class="mi">59</span>	<span class="mi">60</span>
<span class="mi">0</span>	<span class="mf">0.780367</span>	<span class="mf">0.624690</span>	<span class="mf">0.598909</span>	<span class="mf">0.559742</span>	<span class="mf">0.419435</span>	<span class="mf">0.454636</span>	<span class="mf">0.433317</span>	<span class="mf">0.390183</span>	<span class="mf">0.158651</span>	<span class="mf">0.132871</span>	<span class="mf">0.178483</span>	<span class="mf">0.085275</span>	<span class="mf">0.062469</span>	<span class="mf">0.044125</span>	<span class="mf">0.040654</span>	<span class="mf">0.031730</span>	<span class="mf">0.053049</span>	<span class="mf">0.111056</span>	<span class="mf">0.101636</span>	<span class="mf">0.087754</span>	<span class="mf">0.115518</span>	<span class="mf">0.124442</span>	<span class="mf">0.109073</span>	<span class="mf">0.086267</span>	<span class="mf">0.152206</span>	<span class="mf">0.257313</span>	<span class="mf">0.288547</span>	<span class="mf">0.303917</span>	<span class="mf">0.233515</span>	<span class="mf">0.200793</span>	<span class="mf">0.274510</span>	<span class="mf">0.294118</span>	<span class="mf">0.235294</span>	<span class="mf">0.235294</span>	<span class="mf">0.215686</span>	<span class="mf">0.215686</span>	<span class="mf">0.215686</span>	<span class="mf">0.196078</span>	<span class="mf">0.058824</span>	<span class="mf">0.078431</span>	<span class="mf">0.000000</span>	<span class="mf">0.019608</span>	<span class="mf">0.019608</span>	<span class="mf">0.019608</span>	<span class="mf">0.019608</span>	<span class="mf">0.039216</span>	<span class="mf">0.019608</span>	<span class="mf">0.098039</span>	<span class="mf">0.098039</span>	<span class="mf">0.117647</span>	<span class="mf">0.117647</span>	<span class="mf">0.137255</span>	<span class="mf">0.117647</span>	<span class="mf">0.176471</span>	<span class="mf">0.196078</span>	<span class="mf">0.392157</span>	<span class="mf">0.431373</span>	<span class="mf">0.470588</span>	<span class="mf">0.529412</span>	<span class="mf">0.529412</span>	<span class="mi">0</span>
<span class="mi">1</span>	<span class="mf">0.945708</span>	<span class="mf">0.868666</span>	<span class="mf">0.739917</span>	<span class="mf">0.754912</span>	<span class="mf">0.725440</span>	<span class="mf">0.703723</span>	<span class="mf">0.612203</span>	<span class="mf">0.594105</span>	<span class="mf">0.613754</span>	<span class="mf">0.617890</span>	<span class="mf">0.556360</span>	<span class="mf">0.573423</span>	<span class="mf">0.528438</span>	<span class="mf">0.531541</span>	<span class="mf">0.517063</span>	<span class="mf">0.539814</span>	<span class="mf">0.533609</span>	<span class="mf">0.492761</span>	<span class="mf">0.474664</span>	<span class="mf">0.433816</span>	<span class="mf">0.444157</span>	<span class="mf">0.507756</span>	<span class="mf">0.417787</span>	<span class="mf">0.407963</span>	<span class="mf">0.398656</span>	<span class="mf">0.395553</span>	<span class="mf">0.345915</span>	<span class="mf">0.305584</span>	<span class="mf">0.326267</span>	<span class="mf">0.316960</span>	<span class="mf">0.052632</span>	<span class="mf">0.078947</span>	<span class="mf">0.052632</span>	<span class="mf">0.078947</span>	<span class="mf">0.078947</span>	<span class="mf">0.078947</span>	<span class="mf">0.000000</span>	<span class="mf">0.052632</span>	<span class="mf">0.052632</span>	<span class="mf">0.000000</span>	<span class="mf">0.078947</span>	<span class="mf">0.052632</span>	<span class="mf">0.105263</span>	<span class="mf">0.131579</span>	<span class="mf">0.078947</span>	<span class="mf">0.078947</span>	<span class="mf">0.052632</span>	<span class="mf">0.052632</span>	<span class="mf">0.078947</span>	<span class="mf">0.052632</span>	<span class="mf">0.000000</span>	<span class="mf">0.026316</span>	<span class="mf">0.026316</span>	<span class="mf">0.000000</span>	<span class="mf">0.078947</span>	<span class="mf">0.078947</span>	<span class="mf">0.078947</span>	<span class="mf">0.052632</span>	<span class="mf">0.052632</span>	<span class="mf">0.052632</span>	<span class="mi">0</span>
<span class="mi">2</span>	<span class="mf">0.920393</span>	<span class="mf">0.962162</span>	<span class="mf">1.000000</span>	<span class="mf">0.951351</span>	<span class="mf">0.954791</span>	<span class="mf">0.911057</span>	<span class="mf">0.958231</span>	<span class="mf">0.939066</span>	<span class="mf">0.948403</span>	<span class="mf">0.917445</span>	<span class="mf">0.929730</span>	<span class="mf">0.888943</span>	<span class="mf">0.868796</span>	<span class="mf">0.854545</span>	<span class="mf">0.835381</span>	<span class="mf">0.815725</span>	<span class="mf">0.877150</span>	<span class="mf">0.858968</span>	<span class="mf">0.905160</span>	<span class="mf">0.886978</span>	<span class="mf">0.819165</span>	<span class="mf">0.782801</span>	<span class="mf">0.747912</span>	<span class="mf">0.753317</span>	<span class="mf">0.688452</span>	<span class="mf">0.661916</span>	<span class="mf">0.646683</span>	<span class="mf">0.630958</span>	<span class="mf">0.640295</span>	<span class="mf">0.624079</span>	<span class="mf">0.454545</span>	<span class="mf">0.363636</span>	<span class="mf">0.272727</span>	<span class="mf">0.272727</span>	<span class="mf">0.272727</span>	<span class="mf">0.363636</span>	<span class="mf">0.454545</span>	<span class="mf">0.454545</span>	<span class="mf">0.363636</span>	<span class="mf">0.454545</span>	<span class="mf">0.454545</span>	<span class="mf">0.454545</span>	<span class="mf">0.545455</span>	<span class="mf">0.454545</span>	<span class="mf">0.545455</span>	<span class="mf">0.636364</span>	<span class="mf">0.727273</span>	<span class="mf">0.818182</span>	<span class="mf">0.818182</span>	<span class="mf">0.818182</span>	<span class="mf">0.909091</span>	<span class="mf">0.636364</span>	<span class="mf">0.545455</span>	<span class="mf">0.545455</span>	<span class="mf">0.636364</span>	<span class="mf">0.636364</span>	<span class="mf">0.454545</span>	<span class="mf">0.454545</span>	<span class="mf">0.454545</span>	<span class="mf">0.454545</span>	<span class="mi">0</span>
<span class="mi">3</span>	<span class="mf">0.417309</span>	<span class="mf">0.276778</span>	<span class="mf">0.316195</span>	<span class="mf">0.395887</span>	<span class="mf">0.402742</span>	<span class="mf">0.413025</span>	<span class="mf">0.444730</span>	<span class="mf">0.381320</span>	<span class="mf">0.386461</span>	<span class="mf">0.343616</span>	<span class="mf">0.301628</span>	<span class="mf">0.303342</span>	<span class="mf">0.345330</span>	<span class="mf">0.377035</span>	<span class="mf">0.478149</span>	<span class="mf">0.371037</span>	<span class="mf">0.161954</span>	<span class="mf">0.143102</span>	<span class="mf">0.216795</span>	<span class="mf">0.216795</span>	<span class="mf">0.239075</span>	<span class="mf">0.248500</span>	<span class="mf">0.316195</span>	<span class="mf">0.311054</span>	<span class="mf">0.450728</span>	<span class="mf">0.508141</span>	<span class="mf">0.462725</span>	<span class="mf">0.307626</span>	<span class="mf">0.337618</span>	<span class="mf">0.550985</span>	<span class="mf">0.441176</span>	<span class="mf">0.441176</span>	<span class="mf">0.441176</span>	<span class="mf">0.411765</span>	<span class="mf">0.411765</span>	<span class="mf">0.352941</span>	<span class="mf">0.411765</span>	<span class="mf">0.411765</span>	<span class="mf">0.441176</span>	<span class="mf">0.411765</span>	<span class="mf">0.411765</span>	<span class="mf">0.382353</span>	<span class="mf">0.441176</span>	<span class="mf">0.441176</span>	<span class="mf">0.411765</span>	<span class="mf">0.411765</span>	<span class="mf">0.382353</span>	<span class="mf">0.382353</span>	<span class="mf">0.382353</span>	<span class="mf">0.382353</span>	<span class="mf">0.382353</span>	<span class="mf">0.441176</span>	<span class="mf">0.441176</span>	<span class="mf">0.500000</span>	<span class="mf">0.500000</span>	<span class="mf">0.500000</span>	<span class="mf">0.500000</span>	<span class="mf">0.529412</span>	<span class="mf">0.500000</span>	<span class="mf">0.470588</span>	<span class="mi">0</span>
<span class="mi">4</span>	<span class="mf">0.136275</span>	<span class="mf">0.070651</span>	<span class="mf">0.032393</span>	<span class="mf">0.021223</span>	<span class="mf">0.010612</span>	<span class="mf">0.007819</span>	<span class="mf">0.000000</span>	<span class="mf">0.013404</span>	<span class="mf">0.013963</span>	<span class="mf">0.024574</span>	<span class="mf">0.014800</span>	<span class="mf">0.012846</span>	<span class="mf">0.057526</span>	<span class="mf">0.068696</span>	<span class="mf">0.046077</span>	<span class="mf">0.107791</span>	<span class="mf">0.141860</span>	<span class="mf">0.160570</span>	<span class="mf">0.128456</span>	<span class="mf">0.106395</span>	<span class="mf">0.109187</span>	<span class="mf">0.096342</span>	<span class="mf">0.117565</span>	<span class="mf">0.133203</span>	<span class="mf">0.089081</span>	<span class="mf">0.076515</span>	<span class="mf">0.102765</span>	<span class="mf">0.101648</span>	<span class="mf">0.104719</span>	<span class="mf">0.120916</span>	<span class="mf">0.611111</span>	<span class="mf">0.611111</span>	<span class="mf">0.611111</span>	<span class="mf">0.611111</span>	<span class="mf">0.555556</span>	<span class="mf">0.555556</span>	<span class="mf">0.500000</span>	<span class="mf">0.555556</span>	<span class="mf">0.611111</span>	<span class="mf">0.555556</span>	<span class="mf">0.500000</span>	<span class="mf">0.500000</span>	<span class="mf">0.555556</span>	<span class="mf">0.444444</span>	<span class="mf">0.500000</span>	<span class="mf">0.500000</span>	<span class="mf">0.500000</span>	<span class="mf">0.444444</span>	<span class="mf">0.500000</span>	<span class="mf">0.444444</span>	<span class="mf">0.500000</span>	<span class="mf">0.444444</span>	<span class="mf">0.500000</span>	<span class="mf">0.500000</span>	<span class="mf">0.500000</span>	<span class="mf">0.555556</span>	<span class="mf">0.555556</span>	<span class="mf">0.444444</span>	<span class="mf">0.500000</span>	<span class="mf">0.444444</span>	<span class="mi">0</span>
<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>	<span class="p">...</span>
<span class="mi">905</span>	<span class="mf">0.531307</span>	<span class="mf">0.745928</span>	<span class="mf">0.805646</span>	<span class="mf">0.934491</span>	<span class="mf">0.959464</span>	<span class="mf">0.934491</span>	<span class="mf">0.899385</span>	<span class="mf">0.917119</span>	<span class="mf">0.832429</span>	<span class="mf">0.835324</span>	<span class="mf">0.669924</span>	<span class="mf">0.801665</span>	<span class="mf">0.785378</span>	<span class="mf">0.898299</span>	<span class="mf">1.000000</span>	<span class="mf">0.871516</span>	<span class="mf">0.674267</span>	<span class="mf">0.777416</span>	<span class="mf">0.802027</span>	<span class="mf">0.812161</span>	<span class="mf">0.836772</span>	<span class="mf">0.728194</span>	<span class="mf">0.742309</span>	<span class="mf">0.589215</span>	<span class="mf">0.562432</span>	<span class="mf">0.553384</span>	<span class="mf">0.584872</span>	<span class="mf">0.612740</span>	<span class="mf">0.591748</span>	<span class="mf">0.548317</span>	<span class="mf">0.089172</span>	<span class="mf">0.085987</span>	<span class="mf">0.108280</span>	<span class="mf">0.111465</span>	<span class="mf">0.124204</span>	<span class="mf">0.101911</span>	<span class="mf">0.073248</span>	<span class="mf">0.066879</span>	<span class="mf">0.063694</span>	<span class="mf">0.073248</span>	<span class="mf">0.073248</span>	<span class="mf">0.076433</span>	<span class="mf">0.076433</span>	<span class="mf">0.066879</span>	<span class="mf">0.073248</span>	<span class="mf">0.085987</span>	<span class="mf">0.073248</span>	<span class="mf">0.082803</span>	<span class="mf">0.079618</span>	<span class="mf">0.092357</span>	<span class="mf">0.089172</span>	<span class="mf">0.060510</span>	<span class="mf">0.076433</span>	<span class="mf">0.073248</span>	<span class="mf">0.076433</span>	<span class="mf">0.085987</span>	<span class="mf">0.082803</span>	<span class="mf">0.082803</span>	<span class="mf">0.073248</span>	<span class="mf">0.070064</span>	<span class="mi">1</span>
<span class="mi">906</span>	<span class="mf">0.127696</span>	<span class="mf">0.094170</span>	<span class="mf">0.159086</span>	<span class="mf">0.172966</span>	<span class="mf">0.100577</span>	<span class="mf">0.061499</span>	<span class="mf">0.053171</span>	<span class="mf">0.076233</span>	<span class="mf">0.065129</span>	<span class="mf">0.071108</span>	<span class="mf">0.019646</span>	<span class="mf">0.000427</span>	<span class="mf">0.000000</span>	<span class="mf">0.012599</span>	<span class="mf">0.013239</span>	<span class="mf">0.009823</span>	<span class="mf">0.026479</span>	<span class="mf">0.056161</span>	<span class="mf">0.064916</span>	<span class="mf">0.041854</span>	<span class="mf">0.023703</span>	<span class="mf">0.007047</span>	<span class="mf">0.045270</span>	<span class="mf">0.031177</span>	<span class="mf">0.035234</span>	<span class="mf">0.033953</span>	<span class="mf">0.027333</span>	<span class="mf">0.055947</span>	<span class="mf">0.051036</span>	<span class="mf">0.049327</span>	<span class="mf">0.550725</span>	<span class="mf">0.528986</span>	<span class="mf">0.463768</span>	<span class="mf">0.478261</span>	<span class="mf">0.442029</span>	<span class="mf">0.456522</span>	<span class="mf">0.492754</span>	<span class="mf">0.478261</span>	<span class="mf">0.456522</span>	<span class="mf">0.413043</span>	<span class="mf">0.442029</span>	<span class="mf">0.398551</span>	<span class="mf">0.384058</span>	<span class="mf">0.355072</span>	<span class="mf">0.347826</span>	<span class="mf">0.347826</span>	<span class="mf">0.326087</span>	<span class="mf">0.326087</span>	<span class="mf">0.347826</span>	<span class="mf">0.311594</span>	<span class="mf">0.347826</span>	<span class="mf">0.318841</span>	<span class="mf">0.326087</span>	<span class="mf">0.246377</span>	<span class="mf">0.246377</span>	<span class="mf">0.217391</span>	<span class="mf">0.217391</span>	<span class="mf">0.173913</span>	<span class="mf">0.239130</span>	<span class="mf">0.260870</span>	<span class="mi">0</span>
<span class="mi">907</span>	<span class="mf">0.125000</span>	<span class="mf">0.321429</span>	<span class="mf">0.261905</span>	<span class="mf">0.251253</span>	<span class="mf">0.224311</span>	<span class="mf">0.252506</span>	<span class="mf">0.283521</span>	<span class="mf">0.234649</span>	<span class="mf">0.218985</span>	<span class="mf">0.176065</span>	<span class="mf">0.232143</span>	<span class="mf">0.283835</span>	<span class="mf">0.479010</span>	<span class="mf">0.501566</span>	<span class="mf">0.528509</span>	<span class="mf">0.595238</span>	<span class="mf">0.591792</span>	<span class="mf">0.571429</span>	<span class="mf">0.583020</span>	<span class="mf">0.604323</span>	<span class="mf">0.618108</span>	<span class="mf">0.625000</span>	<span class="mf">0.623120</span>	<span class="mf">0.604010</span>	<span class="mf">0.604950</span>	<span class="mf">0.617481</span>	<span class="mf">0.544799</span>	<span class="mf">0.536967</span>	<span class="mf">0.543860</span>	<span class="mf">0.475564</span>	<span class="mf">0.678161</span>	<span class="mf">0.689655</span>	<span class="mf">0.689655</span>	<span class="mf">0.712644</span>	<span class="mf">0.729885</span>	<span class="mf">0.747126</span>	<span class="mf">0.770115</span>	<span class="mf">0.775862</span>	<span class="mf">0.781609</span>	<span class="mf">0.787356</span>	<span class="mf">0.793103</span>	<span class="mf">0.833333</span>	<span class="mf">0.816092</span>	<span class="mf">0.816092</span>	<span class="mf">0.810345</span>	<span class="mf">0.781609</span>	<span class="mf">0.793103</span>	<span class="mf">0.827586</span>	<span class="mf">0.856322</span>	<span class="mf">0.833333</span>	<span class="mf">0.844828</span>	<span class="mf">0.850575</span>	<span class="mf">0.833333</span>	<span class="mf">0.879310</span>	<span class="mf">0.844828</span>	<span class="mf">0.827586</span>	<span class="mf">0.827586</span>	<span class="mf">0.798851</span>	<span class="mf">0.804598</span>	<span class="mf">0.816092</span>	<span class="mi">0</span>
<span class="mi">908</span>	<span class="mf">0.401929</span>	<span class="mf">0.343822</span>	<span class="mf">0.227147</span>	<span class="mf">0.194993</span>	<span class="mf">0.229904</span>	<span class="mf">0.238401</span>	<span class="mf">0.192007</span>	<span class="mf">0.112770</span>	<span class="mf">0.126321</span>	<span class="mf">0.105880</span>	<span class="mf">0.097382</span>	<span class="mf">0.110703</span>	<span class="mf">0.162150</span>	<span class="mf">0.121727</span>	<span class="mf">0.081994</span>	<span class="mf">0.065687</span>	<span class="mf">0.067754</span>	<span class="mf">0.063390</span>	<span class="mf">0.074874</span>	<span class="mf">0.087046</span>	<span class="mf">0.055581</span>	<span class="mf">0.107717</span>	<span class="mf">0.061323</span>	<span class="mf">0.055811</span>	<span class="mf">0.041801</span>	<span class="mf">0.035599</span>	<span class="mf">0.000000</span>	<span class="mf">0.036059</span>	<span class="mf">0.058567</span>	<span class="mf">0.075333</span>	<span class="mf">0.979275</span>	<span class="mf">0.994819</span>	<span class="mf">0.953368</span>	<span class="mf">0.932642</span>	<span class="mf">0.958549</span>	<span class="mf">0.968912</span>	<span class="mf">0.932642</span>	<span class="mf">0.911917</span>	<span class="mf">0.948187</span>	<span class="mf">0.979275</span>	<span class="mf">1.000000</span>	<span class="mf">0.994819</span>	<span class="mf">0.994819</span>	<span class="mf">0.958549</span>	<span class="mf">0.953368</span>	<span class="mf">0.927461</span>	<span class="mf">0.911917</span>	<span class="mf">0.932642</span>	<span class="mf">0.953368</span>	<span class="mf">0.948187</span>	<span class="mf">0.979275</span>	<span class="mf">0.958549</span>	<span class="mf">0.979275</span>	<span class="mf">0.937824</span>	<span class="mf">0.932642</span>	<span class="mf">0.932642</span>	<span class="mf">0.979275</span>	<span class="mf">0.984456</span>	<span class="mf">0.974093</span>	<span class="mf">0.958549</span>	<span class="mi">0</span>
<span class="mi">909</span>	<span class="mf">0.018349</span>	<span class="mf">0.033276</span>	<span class="mf">0.045872</span>	<span class="mf">0.023636</span>	<span class="mf">0.012284</span>	<span class="mf">0.027678</span>	<span class="mf">0.052247</span>	<span class="mf">0.081947</span>	<span class="mf">0.096564</span>	<span class="mf">0.081014</span>	<span class="mf">0.074016</span>	<span class="mf">0.088944</span>	<span class="mf">0.080858</span>	<span class="mf">0.043228</span>	<span class="mf">0.027523</span>	<span class="mf">0.046494</span>	<span class="mf">0.050381</span>	<span class="mf">0.050536</span>	<span class="mf">0.077437</span>	<span class="mf">0.067797</span>	<span class="mf">0.062510</span>	<span class="mf">0.029544</span>	<span class="mf">0.009641</span>	<span class="mf">0.044006</span>	<span class="mf">0.046649</span>	<span class="mf">0.061888</span>	<span class="mf">0.075260</span>	<span class="mf">0.088167</span>	<span class="mf">0.058311</span>	<span class="mf">0.051625</span>	<span class="mf">0.000000</span>	<span class="mf">0.067797</span>	<span class="mf">0.067797</span>	<span class="mf">0.322034</span>	<span class="mf">0.372881</span>	<span class="mf">0.474576</span>	<span class="mf">0.474576</span>	<span class="mf">0.457627</span>	<span class="mf">0.576271</span>	<span class="mf">0.508475</span>	<span class="mf">0.508475</span>	<span class="mf">0.491525</span>	<span class="mf">0.593220</span>	<span class="mf">0.694915</span>	<span class="mf">0.661017</span>	<span class="mf">0.745763</span>	<span class="mf">0.813559</span>	<span class="mf">0.779661</span>	<span class="mf">0.847458</span>	<span class="mf">0.881356</span>	<span class="mf">0.949153</span>	<span class="mf">1.000000</span>	<span class="mf">0.966102</span>	<span class="mf">0.983051</span>	<span class="mf">0.966102</span>	<span class="mf">0.881356</span>	<span class="mf">0.898305</span>	<span class="mf">0.915254</span>	<span class="mf">0.932203</span>	<span class="mf">0.966102</span>	<span class="mi">0</span>
</pre></table></code></div></div><p>한 row당 하루의 장 흐름 데이터이며</p><p>col 0~29은 외국인 순 거래량 분봉 데이터, 30 ~ 59은 선물 지수 분봉 데이터, 마지막 60은 1%이상 상승했는지를 나타내는 Label이다.</p><h1 id="모델-생성">모델 생성</h1><p>데이터는 준비되었으니 준비된 데이터로 학습을 진행한다.</p><p>학습 이전에 학습용 데이터와 테스트용 데이터를 7:3 비율로 나눈다.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/train_with_index.csv'</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">60</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s">'60'</span><span class="p">]</span>

<span class="n">train_x</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></table></code></div></div><p>학습에 사용할 라이브러리는 AutoKeras이다.</p><p>AutoKeras의 사용법은 간단하다. 학습시킬 데이터의 형태에 맞는 클래스를 선택해서 최대 반복 횟수와 epochs만 지정해주면 학습을 반복하면서 가장 성능이 좋은 모델을 찾아낸다.</p><p>만약 더이상 성능이 개선될 여지가 없으면 조기 종료된다.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">autokeras</span> <span class="k">as</span> <span class="n">ak</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">ak</span><span class="p">.</span><span class="n">StructuredDataClassifier</span><span class="p">(</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_trials</span><span class="o">=</span><span class="mi">300</span>
<span class="p">)</span>

<span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">train_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">train_y</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre>Trial 54 Complete <span class="o">[</span>00h 00m 07s]
val_accuracy: 0.8560000061988831

Best val_accuracy So Far: 0.9120000004768372
Total elapsed <span class="nb">time</span>: 00h 05m 44s
INFO:tensorflow:Oracle triggered <span class="nb">exit
</span>Epoch 1/20
20/20 <span class="o">[==============================]</span> - 1s 3ms/step - loss: 0.4540 - accuracy: 0.7622
Epoch 2/20
20/20 <span class="o">[==============================]</span> - 0s 4ms/step - loss: 0.3211 - accuracy: 0.8421
Epoch 3/20
20/20 <span class="o">[==============================]</span> - 0s 4ms/step - loss: 0.2995 - accuracy: 0.8523
Epoch 4/20
20/20 <span class="o">[==============================]</span> - 0s 3ms/step - loss: 0.2896 - accuracy: 0.8717
Epoch 5/20
20/20 <span class="o">[==============================]</span> - 0s 3ms/step - loss: 0.2848 - accuracy: 0.8792
Epoch 6/20
20/20 <span class="o">[==============================]</span> - 0s 4ms/step - loss: 0.2821 - accuracy: 0.8736
Epoch 7/20
20/20 <span class="o">[==============================]</span> - 0s 3ms/step - loss: 0.2740 - accuracy: 0.8794
Epoch 8/20
20/20 <span class="o">[==============================]</span> - 0s 4ms/step - loss: 0.2737 - accuracy: 0.8708
Epoch 9/20
20/20 <span class="o">[==============================]</span> - 0s 3ms/step - loss: 0.2689 - accuracy: 0.8691
Epoch 10/20
20/20 <span class="o">[==============================]</span> - 0s 3ms/step - loss: 0.2693 - accuracy: 0.8718
Epoch 11/20
20/20 <span class="o">[==============================]</span> - 0s 4ms/step - loss: 0.2643 - accuracy: 0.8721
Epoch 12/20
20/20 <span class="o">[==============================]</span> - 0s 5ms/step - loss: 0.2680 - accuracy: 0.8651
Epoch 13/20
20/20 <span class="o">[==============================]</span> - 0s 5ms/step - loss: 0.2601 - accuracy: 0.8693
Epoch 14/20
20/20 <span class="o">[==============================]</span> - 0s 4ms/step - loss: 0.2622 - accuracy: 0.8711
Epoch 15/20
20/20 <span class="o">[==============================]</span> - 0s 5ms/step - loss: 0.2537 - accuracy: 0.8711
Epoch 16/20
20/20 <span class="o">[==============================]</span> - 0s 5ms/step - loss: 0.2589 - accuracy: 0.8696
Epoch 17/20
20/20 <span class="o">[==============================]</span> - 0s 4ms/step - loss: 0.2529 - accuracy: 0.8661
Epoch 18/20
20/20 <span class="o">[==============================]</span> - 0s 4ms/step - loss: 0.2512 - accuracy: 0.8718
Epoch 19/20
20/20 <span class="o">[==============================]</span> - 0s 5ms/step - loss: 0.2498 - accuracy: 0.8783
Epoch 20/20
20/20 <span class="o">[==============================]</span> - 0s 4ms/step - loss: 0.2458 - accuracy: 0.8821
INFO:tensorflow:Assets written to: ./structured_data_classifier/best_model/assets
</pre></table></code></div></div><p>54번의 반복후에 91%의 정확도를 가진 모델이 생성되었다.</p><h1 id="평가">평가</h1><p>내부적으로 학습 데이터를 나누어 (20%) 검증에 사용하지만 따로 분리해 둔 테스트용 데이터로 성능을 다시 테스트 해본다.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>

<span class="n">pre</span> <span class="o">=</span> <span class="n">clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">pre</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">pre</span><span class="p">))</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>               precision    recall  f1-score   support

           0       0.90      0.93      0.91       233
           1       0.47      0.38      0.42        40

    accuracy                           0.85       273
   macro avg       0.68      0.65      0.66       273
weighted avg       0.83      0.85      0.84       273

<span class="o">[[</span>216  17]
 <span class="o">[</span> 25  15]]
</pre></table></code></div></div><p>평균 정확도는 85%이지만 자세히 살펴보면 Positve을 예측하는 정도, 즉 1% 이상 오르는지에 대한 예측 성능은 낮다.</p><p>Precision, Recall, F1-Score 전부 0.5 이하의 점수가 나온다.</p><p>즉 지금 데이터로는 장 마감시 지수 예측을 거의 못한다는 뜻이다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EC%9E%90%EB%8F%99%EB%A7%A4%EB%A7%A4/'>자동매매</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/%EC%84%A0%EB%AC%BC/" class="post-tag no-text-decoration" >선물</a> <a href="/tags/wjrmffldrhrl/" class="post-tag no-text-decoration" >wjrmffldrhrl</a> <a href="/tags/%EB%A8%B8%EC%8B%A0%EB%9F%AC%EB%8B%9D/" class="post-tag no-text-decoration" >머신러닝</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=선물시장 외국인 수급과 AutoML 연구 - Seomse&url=https://seomse.github.io/posts/Foreign-Automl/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=선물시장 외국인 수급과 AutoML 연구 - Seomse&u=https://seomse.github.io/posts/Foreign-Automl/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=선물시장 외국인 수급과 AutoML 연구 - Seomse&url=https://seomse.github.io/posts/Foreign-Automl/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/realtime-search-analysis/">리얼타임 인메모리 검색, 분석, 통계</a><li><a href="/posts/trading-auto-dev-ing/">자동매매를 개발하면서 경험한 것(주식, ETF, 선물, 비트코인)</a><li><a href="/posts/parallel-processing/">빅데이터 파일 병렬처리 플랫폼을 개발하면서</a><li><a href="/posts/elk-stack/">ELK Stack 설치하기</a><li><a href="/posts/seomse-jdbc/">seomse-jdbc 개발 배경과 활용법</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/macle/">macle</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/etf/">ETF</a> <a class="post-tag" href="/tags/%EC%84%A0%EB%AC%BC/">선물</a> <a class="post-tag" href="/tags/%EC%A3%BC%EC%8B%9D/">주식</a> <a class="post-tag" href="/tags/file/">file</a> <a class="post-tag" href="/tags/wjrmffldrhrl/">wjrmffldrhrl</a> <a class="post-tag" href="/tags/%EB%B3%91%EB%A0%AC%EC%B2%98%EB%A6%AC/">병렬처리</a> <a class="post-tag" href="/tags/%EB%B9%84%ED%8A%B8%EC%BD%94%EC%9D%B8/">비트코인</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Java-Serialization/"><div class="card-body"> <span class="timeago small" > Jan 22 <i class="unloaded">2021-01-22T12:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java Serialization</h3><div class="text-muted small"><p> What is Serialize? 객체 또는 데이터를 바이트 형태로 변환하는 기술 바이트로 변환된 데이터를 다시 객체로 변환하는 기술 이 두가지를 아울러서 이야기한다. How to use 기본 타입 맴버와 java.io.Serializable인터페이스를 상속받은 객체는 직렬화 할 수 있는 기본 조건을 가진다. public class ...</p></div></div></a></div><div class="card"> <a href="/posts/trading_start/"><div class="card-body"> <span class="timeago small" > Jan 15 <i class="unloaded">2021-01-15T22:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자동 매매 연구</h3><div class="text-muted small"><p> 작성자 : macle 작성자 블로그: https://macle.dev 원본경로: https://macle.dev/posts/trading_start/ 연구 방향 자동매매 관련 연구를 시작합니다. 데이터를 정형화 하여 자동매매에 활용하는 연구이며, 백테스팅 결과에 의존하여 자동매매 하므로 정형화 되어 있지 않은 데이터...</p></div></div></a></div><div class="card"> <a href="/posts/trading-auto-dev-ing/"><div class="card-body"> <span class="timeago small" > Apr 3 <i class="unloaded">2021-04-03T22:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자동매매를 개발하면서 경험한 것(주식, ETF, 선물, 비트코인)</h3><div class="text-muted small"><p> 작성자 : macle 작성자 블로그: https://macle.dev 원본경로: https://macle.dev/posts/trading-auto-dev-ing/ 개요 자동매매를 개발하면서 경험한 문제들, 실패한 연구, 성공적인 연구에 관한 내용입니다. 제가 직접 경험한 내용들이 주내용이라 여러사람의 경험과는 다를 수 있습니다. 실패...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/seomse-jdbc/" class="btn btn-outline-primary"><p>seomse-jdbc 개발 배경과 활용법</p></a> <a href="/posts/parallel-processing/" class="btn btn-outline-primary"><p>빅데이터 파일 병렬처리 플랫폼을 개발하면서</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//https-seomse-github-io-1.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://seomse.github.io/posts/Foreign-Automl/'; this.page.identifier = '/posts/Foreign-Automl/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/comseomse">seomse</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/macle/">macle</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/etf/">ETF</a> <a class="post-tag" href="/tags/%EC%84%A0%EB%AC%BC/">선물</a> <a class="post-tag" href="/tags/%EC%A3%BC%EC%8B%9D/">주식</a> <a class="post-tag" href="/tags/file/">file</a> <a class="post-tag" href="/tags/wjrmffldrhrl/">wjrmffldrhrl</a> <a class="post-tag" href="/tags/%EB%B3%91%EB%A0%AC%EC%B2%98%EB%A6%AC/">병렬처리</a> <a class="post-tag" href="/tags/%EB%B9%84%ED%8A%B8%EC%BD%94%EC%9D%B8/">비트코인</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://seomse.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
